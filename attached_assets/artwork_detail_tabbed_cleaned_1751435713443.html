{% extends 'base.html' %}
{% load static %}

{% block title %}{{ artwork.title }} - Brush Up{% endblock %}

{% block extra_css %}
<style>
 /* Base styles */
    body {
        background: #1a1a1a;
        color: #fff;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow-x: hidden;
    }

    /* Focus Mode Styles */
    #focus-mode {
        position: relative;
        min-height: 100vh;
        background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
    }

    #focus-artwork {
        max-width: 95vw;
        max-height: 95vh;
        object-fit: contain;
        cursor: pointer;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        transition: transform 0.3s ease;
    }

    #focus-artwork:hover {
        transform: scale(1.02);
    }

    /* Actions Bar */
    #artwork-actions-bar {
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(15px);
        border-radius: 25px;
        padding: 0.75rem 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        gap: 1rem;
        z-index: 100;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .btn-like {
        background: linear-gradient(135deg, #e91e63, #f06292);
        border: none;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 500;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-like:hover {
        background: linear-gradient(135deg, #c2185b, #e91e63);
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(233, 30, 99, 0.5);
    }

    .btn-icon {
        font-size: 1.1rem;
    }

    /* Version Badge */
    .position-absolute .badge {
        background: rgba(13, 110, 253, 0.9) !important;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 500;
    }

    /* Scroll Indicator */
    .scroll-indicator {
        position: fixed;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        animation: bounce 2s infinite;
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
        40% { transform: translateX(-50%) translateY(-10px); }
        60% { transform: translateX(-50%) translateY(-5px); }
    }

    /* Split-view layout styles */
    .split-view-container {
        min-height: 100vh;
    }

    .artwork-panel {
        background: #1a1a1a;
        position: sticky;
        top: 0;
        height: 100vh;
        overflow: hidden;
    }

    .artwork-panel img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        cursor: pointer;
    }

    .companion-panel {
        background: #121212;
        border-left: 1px solid rgba(255,255,255,0.05);
        height: 100vh;
        overflow-y: auto;
        padding: 2rem;
    }

    .artwork-info-section {
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .artwork-info-section h2 {
        font-size: 1.75rem;
        font-weight: 300;
        margin-bottom: 0.5rem;
    }

    .artwork-info-section .artist-info {
        color: #aaa;
        margin-bottom: 0.75rem;
    }

    .artwork-meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .meta-item {
        text-align: center;
        padding: 0.75rem;
        background: rgba(255,255,255,0.02);
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.05);
    }

    .meta-item .label {
        display: block;
        font-size: 0.75rem;
        text-transform: uppercase;
        color: #888;
        margin-bottom: 0.25rem;
    }

    .meta-item .value {
        font-weight: 500;
        color: #fff;
    }

    .panel-section {
        margin-bottom: 2rem;
    }

    .panel-section h3 {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 1rem;
        color: #fff;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 0.5rem;
    }

    .version-thumbnails {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .version-thumb {
        aspect-ratio: 1;
        border-radius: 8px;
        overflow: hidden;
        border: 2px solid transparent;
        cursor: pointer;
        transition: border-color 0.2s ease;
    }

    .version-thumb:hover {
        border-color: #6f42c1;
    }

    .version-thumb.current {
        border-color: #0d6efd;
    }

    .version-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .critique-compact {
        background: rgba(255,255,255,0.03);
        border: 1px solid rgba(255,255,255,0.05);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .critique-compact .author-info {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem;
    }

    .critique-compact .author-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        margin-right: 0.75rem;
    }

    .critique-compact .author-name {
        font-weight: 500;
        margin-bottom: 0.125rem;
    }

    .critique-compact .critique-date {
        font-size: 0.75rem;
        color: #888;
    }

    .critique-compact .critique-content {
        font-size: 0.9rem;
        line-height: 1.4;
        margin-bottom: 0.75rem;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .critique-compact .reactions-compact {
        display: flex;
        gap: 0.5rem;
        font-size: 0.75rem;
    }

    .view-mode-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(0,0,0,0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 8px;
        padding: 0.5rem;
    }

    /* Bounce animation for actions bar */
    @keyframes bounceIn {
        0% {
            opacity: 0;
            transform: translateX(-50%) translateY(100px) scale(0.8);
        }
        60% {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px) scale(1.05);
        }
        100% {
            opacity: 1;
            transform: translateX(-50%) translateY(0) scale(1);
        }
    }

    #artwork-actions-bar.animate-in {
        animation: bounceIn 0.6s ease-out;
    }

    /* Mobile responsiveness for split view */
    @media (max-width: 991px) {
        .split-view-container {
            flex-direction: column;
        }
        
        .artwork-panel {
            height: 50vh;
            position: relative;
        }
        
        .companion-panel {
            height: auto;
            border-left: none;
            border-top: 1px solid rgba(255,255,255,0.05);
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Focus Mode Section -->
<section id="focus-mode">
 <img alt="{{ artwork.title }}" id="focus-artwork" onclick="enterFullscreen(this)" src="{% if current_version and current_version.image %}{{ current_version.image.url }}{% elif current_version and current_version.image_url %}{{ current_version.image_url }}{% elif artwork.image %}{{ artwork.image.url }}{% elif artwork.image_url %}{{ artwork.image_url }}{% endif %}"/>
 <!-- Enhanced Actions Bar -->
 <div class="d-flex align-items-center" id="artwork-actions-bar">
  <button aria-label="Favorite" class="btn btn-like" onclick="toggleFavorite({{ artwork.id }})" title="Add to Favorites">
   <span class="btn-icon">
    ♥
   </span>
   Favorite
  </button>
  <a class="btn btn-outline-light" href="#scroll-anchor" onclick="exitFocusMode()">
   <svg class="bi bi-chat-left-text btn-icon" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
    <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z">
    </path>
    <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z">
    </path>
   </svg>
   See Critiques
  </a>
  <a class="btn btn-primary" href="{% url 'critique:create_critique' artwork.id %}">
   <svg class="bi bi-pencil btn-icon" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L5.707 14H2v-3.707L12.146.146zm3 3L13 5.293l-11 11V15h1.293l11-11z">
    </path>
   </svg>
   Add Critique
  </a>
  <button class="btn btn-outline-light" onclick="enterFullscreen(document.getElementById('focus-artwork'))" title="Fullscreen View">
   <svg class="bi bi-arrows-fullscreen btn-icon" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
    <path d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z" fill-rule="evenodd">
    </path>
   </svg>
   Fullscreen
  </button>
 </div>
 <!-- Version Info (properly positioned) -->
 <div class="position-absolute top-0 end-0 mt-3 me-3 z-1">
  <span class="badge bg-primary">
   v{{ current_version_number|default:"1" }} (Current)
  </span>
 </div>
 <!-- Scroll Indicator -->
 <div class="scroll-indicator" onclick="exitFocusMode()">
  <svg class="bi bi-chevron-down" fill="currentColor" height="24" viewbox="0 0 16 16" width="24" xmlns="http://www.w3.org/2000/svg">
   <path d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" fill-rule="evenodd">
   </path>
  </svg>
 </div>
</section>
<div class="container mt-5">
 <ul class="nav nav-tabs justify-content-center" id="artworkTab" role="tablist">
  <li class="nav-item" role="presentation">
   <button class="nav-link active" data-bs-target="#tab-info" data-bs-toggle="tab" id="info-tab" role="tab" type="button">
    Info
   </button>
  </li>
  <li class="nav-item" role="presentation">
   <button class="nav-link" data-bs-target="#tab-critiques" data-bs-toggle="tab" id="critiques-tab" role="tab" type="button">
    Critiques
   </button>
  </li>
  <li class="nav-item" role="presentation">
   <button class="nav-link" data-bs-target="#tab-versions" data-bs-toggle="tab" id="versions-tab" role="tab" type="button">
    Versions
   </button>
  </li>
 </ul>
 <div class="tab-content bg-dark text-white p-4 rounded-bottom" id="artworkTabContent">
  <div class="tab-pane fade show active" id="tab-info" role="tabpanel">
   <p>
    <strong>
     Title:
    </strong>
    {{ artwork.title }}
   </p>
   <p>
    <strong>
     Created:
    </strong>
    {{ artwork.created }}
   </p>
   <p>
    <strong>
     Artist:
    </strong>
    {{ artist.username }}
   </p>
   <p>
    <strong>
     Portfolio:
    </strong>
    {{ artwork.portfolio }}
   </p>
  </div>
  <div class="tab-pane fade" id="tab-critiques" role="tabpanel">
   {% include "critique/partials/critique_list.html" %}
  </div>
  <div class="tab-pane fade" id="tab-versions" role="tabpanel">
   {% include "critique/partials/version_history.html" %}
  </div>
 </div>
</div>
<!-- View Mode Toggle -->
<div class="view-mode-toggle">
 <button class="btn btn-sm btn-outline-light" id="viewModeBtn" onclick="toggleViewMode()">
  <svg class="bi bi-layout-split me-1" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
   <path d="M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm8.5-1v12H14a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H8.5zm-1 0H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h5.5V2z">
   </path>
  </svg>
  Split View
 </button>
</div>
<!-- Split View Layout -->
<div class="d-flex flex-lg-row flex-column split-view-container" id="scroll-anchor">
 <!-- Artwork Panel -->
 <div class="artwork-panel flex-grow-1 d-flex align-items-center justify-content-center">
 </div>
 <!-- Companion Panel -->
 <aside class="companion-panel" style="width: 480px;">
  <!-- Artwork Info Section -->
  <div class="artwork-info-section">
   <h2>
    {{ artwork.title }}
   </h2>
   <div class="artist-info">
    <strong>
     {{ artwork.author.username }}
    </strong>
    {% if artwork.author.profile.profile_image %}
    {% endif %}
   </div>
   <p class="text-muted mb-3">
    Created {{ artwork.created_at|date:"M d, Y" }}
   </p>
   <!-- Artwork Meta Grid -->
   <div class="artwork-meta">
    <div class="meta-item">
     <span class="label">
      Version
     </span>
     <span class="value">
      v{{ current_version_number|default:"1" }}
     </span>
    </div>
    <div class="meta-item">
     <span class="label">
      Critiques
     </span>
     <span class="value">
      {{ critiques.count }}
     </span>
    </div>
    <div class="meta-item">
     <span class="label">
      Views
     </span>
     <span class="value">
      {{ artwork.view_count|default:"0" }}
     </span>
    </div>
    {% if artwork.category %}
    <div class="meta-item">
     <span class="label">
      Category
     </span>
     <span class="value">
      {{ artwork.category }}
     </span>
    </div>
    {% endif %}
   </div>
   {% if artwork.description %}
   <p class="text-light">
    {{ artwork.description|linebreaks }}
   </p>
   {% endif %}
   <!-- Quick Actions -->
   <div class="d-flex gap-2 mt-3">
    <a class="btn btn-primary btn-sm" href="{% url 'critique:create_critique' artwork.id %}">
     <svg class="bi bi-plus-circle me-1" fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z">
      </path>
      <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z">
      </path>
     </svg>
     Add Critique
    </a>
    <button class="btn btn-outline-light btn-sm" onclick="toggleFavorite({{ artwork.id }})">
     ♥ Favorite
    </button>
   </div>
  </div>
  <!-- Version History Section -->
  {% if versions %}
  <div class="panel-section">
   <h3>
    Version History
   </h3>
   <div class="version-thumbnails">
    <!-- Current Version -->
    <div class="version-thumb current" onclick="switchToCurrentVersion({{ artwork.id }})" title="Current Version">
     {% if current_version and current_version.image %}
     {% elif current_version and current_version.image_url %}
     {% elif artwork.image %}
     {% elif artwork.image_url %}
     {% endif %}
    </div>
    <!-- Other Versions -->
    {% for version in versions %}
                    {% if not version.is_archived %}
    <div class="version-thumb" onclick="switchToVersion({{ version.id }})" title="Version {{ version.version_number }}">
     {% if version.image %}
     {% elif version.image_url %}
     {% endif %}
    </div>
    {% endif %}
                {% endfor %}
   </div>
  </div>
  {% endif %}
  <!-- Critiques Section -->
  <div class="panel-section">
   <h3>
    Critiques ({{ critiques.count }})
   </h3>
   {% if critiques %}
   <div class="critiques-compact">
    {% for critique in critiques %}
    <div class="critique-compact">
     <div class="author-info">
      <div>
       <div class="author-name">
        {{ critique.author.username }}
       </div>
       <div class="critique-date">
        {{ critique.created_at|timesince }} ago
       </div>
      </div>
      {% if critique.average_rating %}
      <div class="ms-auto">
       <span class="badge bg-primary">
        {{ critique.average_rating|floatformat:1 }}/10
       </span>
      </div>
      {% endif %}
     </div>
     <div class="critique-content">
      {{ critique.content|truncatechars:150 }}
     </div>
     <div class="reactions-compact">
      <span class="badge bg-secondary">
       {{ critique.helpful_count }} helpful
      </span>
      <span class="badge bg-secondary">
       {{ critique.inspiring_count }} inspiring
      </span>
      <span class="badge bg-secondary">
       {{ critique.detailed_count }} detailed
      </span>
     </div>
    </div>
    {% endfor %}
   </div>
   {% else %}
   <div class="text-center py-4">
    <svg class="bi bi-chat-text text-muted mb-2" fill="currentColor" height="32" viewbox="0 0 16 16" width="32" xmlns="http://www.w3.org/2000/svg">
     <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z">
     </path>
     <path d="M4 5.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8zm0 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z">
     </path>
    </svg>
    <p class="text-muted small mb-0">
     No critiques yet
    </p>
   </div>
   {% endif %}
  </div>
 </aside>
</div>
{% endblock %}

{% block extra_js %}
<script>
 // Focus Mode and View Management
let currentViewMode = 'focus'; // focus, split
let focusModeTimer;

document.addEventListener('DOMContentLoaded', function() {
    initializeFocusMode();
    initializeViewModeToggle();
    setupScrollDetection();
});

function initializeFocusMode() {
    const focusMode = document.getElementById('focus-mode');
    const actionsBar = document.getElementById('artwork-actions-bar');
    
    if (!focusMode || !actionsBar) return;
    
    // Start Focus Mode sequence
    setTimeout(() => {
        // Show actions bar with animation
        actionsBar.style.opacity = '1';
        actionsBar.classList.add('animate-in');
        
        // Start auto-transition timer (8 seconds)
        focusModeTimer = setTimeout(() => {
            exitFocusMode();
        }, 8000);
        
    }, 2000); // 2-second delay before showing UI
}

function setupScrollDetection() {
    let hasScrolled = false;
    
    window.addEventListener('scroll', function() {
        if (window.scrollY > 100 && !hasScrolled) {
            hasScrolled = true;
            // Clear auto-transition if user scrolls
            if (focusModeTimer) {
                clearTimeout(focusModeTimer);
            }
            exitFocusMode();
        }
    });
}

function exitFocusMode() {
    const scrollAnchor = document.getElementById('scroll-anchor');
    if (scrollAnchor) {
        scrollAnchor.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    }
    
    // Clear any remaining timers
    if (focusModeTimer) {
        clearTimeout(focusModeTimer);
    }
    
    // Update view mode
    currentViewMode = 'split';
    updateViewModeButton();
}

function initializeViewModeToggle() {
    updateViewModeButton();
}

function toggleViewMode() {
    if (currentViewMode === 'focus') {
        exitFocusMode();
    } else {
        enterFocusMode();
    }
}

function enterFocusMode() {
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
    currentViewMode = 'focus';
    updateViewModeButton();
    
    // Restart focus mode sequence
    setTimeout(() => {
        initializeFocusMode();
    }, 500);
}

function updateViewModeButton() {
    const btn = document.getElementById('viewModeBtn');
    if (!btn) return;
    
    if (currentViewMode === 'focus') {
        btn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-layout-split me-1" viewBox="0 0 16 16">
                <path d="M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm8.5-1v12H14a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H8.5zm-1 0H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h5.5V2z"/>
            </svg>
            Split View
        `;
    } else {
        btn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-fullscreen me-1" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z"/>
            </svg>
            Focus Mode
        `;
    }
}

// Fullscreen functionality
function enterFullscreen(element) {
    if (element.requestFullscreen) {
        element.requestFullscreen();
    } else if (element.mozRequestFullScreen) {
        element.mozRequestFullScreen();
    } else if (element.webkitRequestFullscreen) {
        element.webkitRequestFullscreen();
    } else if (element.msRequestFullscreen) {
        element.msRequestFullscreen();
    }
}

// Version switching functionality
function switchToVersion(versionId) {
    // Update artwork images in both focus mode and split view
    const focusArtwork = document.getElementById('focus-artwork');
    const splitArtwork = document.querySelector('.artwork-panel img');
    
    // Make API call to get version data
    fetch(`/api/artworks/versions/${versionId}/`)
        .then(response => response.json())
        .then(data => {
            const imageUrl = data.image || data.image_url;
            if (imageUrl) {
                if (focusArtwork) {
                    focusArtwork.src = imageUrl;
                }
                if (splitArtwork) {
                    splitArtwork.src = imageUrl;
                }
                
                // Update version badge
                const versionBadge = document.querySelector('.position-absolute .badge');
                if (versionBadge && data.version_number) {
                    versionBadge.textContent = `v${data.version_number} (Current)`;
                }
                
                // Update version thumbnails highlighting
                document.querySelectorAll('.version-thumb').forEach(thumb => {
                    thumb.classList.remove('current');
                });
                document.querySelector(`[onclick*="${versionId}"]`)?.classList.add('current');
            }
        })
        .catch(error => {
            console.error('Error switching version:', error);
        });
}

function switchToCurrentVersion(artworkId) {
    // Switch back to main artwork
    location.reload(); // Simple approach - reload to show current state
}

// Favorite functionality
function toggleFavorite(artworkId) {
    fetch(`/api/artworks/${artworkId}/favorite/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        // Update favorite button appearance
        const btn = document.querySelector('[onclick*="toggleFavorite"]');
        if (btn) {
            if (data.favorited) {
                btn.innerHTML = '♥ Favorited';
                btn.classList.remove('btn-outline-light');
                btn.classList.add('btn-danger');
            } else {
                btn.innerHTML = '♥ Favorite';
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-outline-light');
            }
        }
    })
    .catch(error => {
        console.error('Error toggling favorite:', error);
    });
}

// CSRF token helper
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}
