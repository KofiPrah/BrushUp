{% extends 'base.html' %}
{% load static %}

{% block title %}{{ artwork.title }} - Brush Up{% endblock %}

{% block extra_css %}
<style>
    /* Base styles */
    body {
        background: #1a1a1a;
        color: #fff;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow-x: hidden;
    }

    /* Focus Mode Styles */
    #focus-mode {
        position: relative;
        min-height: 100vh;
        background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 2rem 1rem;
    }

    #focus-artwork {
        max-width: 95vw;
        max-height: 95vh;
        object-fit: contain;
        cursor: pointer;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        transition: transform 0.3s ease;
    }

    #focus-artwork:hover {
        transform: scale(1.02);
    }

    /* Actions Bar */
    #artwork-actions-bar {
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(15px);
        border-radius: 25px;
        padding: 0.75rem 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        gap: 1rem;
        z-index: 100;
        opacity: 1;
        transition: opacity 0.3s ease;
    }

    .btn-like {
        background: linear-gradient(135deg, #e91e63, #f06292);
        border: none;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 500;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-like:hover {
        background: linear-gradient(135deg, #c2185b, #e91e63);
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(233, 30, 99, 0.5);
    }

    .btn-icon {
        font-size: 1.1rem;
    }

    /* Version Badge */
    .version-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(13, 110, 253, 0.9) !important;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 500;
        z-index: 10;
    }

    /* Scroll Indicator */
    .scroll-indicator {
        position: fixed;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        animation: bounce 2s infinite;
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
        40% { transform: translateX(-50%) translateY(-10px); }
        60% { transform: translateX(-50%) translateY(-5px); }
    }

    /* Tabbed Layout Styles */
    .nav-tabs {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 0;
    }

    .nav-tabs .nav-link {
        background: transparent;
        border: none;
        color: #aaa;
        font-weight: 500;
        padding: 1rem 2rem;
        border-bottom: 2px solid transparent;
        transition: all 0.3s ease;
    }

    .nav-tabs .nav-link:hover {
        color: #fff;
        border-bottom-color: rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.05);
    }

    .nav-tabs .nav-link.active {
        color: #fff;
        background: rgba(13, 110, 253, 0.1);
        border-bottom-color: #0d6efd;
    }

    .tab-content {
        background: #121212;
        border-radius: 0 0 12px 12px;
        min-height: 400px;
    }

    /* Info Tab Styles */
    .artwork-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .info-section {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 1.5rem;
    }

    .info-section h3 {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 1rem;
        color: #0d6efd;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 0.5rem;
    }

    .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .info-item:last-child {
        border-bottom: none;
    }

    .info-label {
        font-weight: 500;
        color: #aaa;
    }

    .info-value {
        color: #fff;
        font-weight: 500;
    }

    /* Critique Tab Styles */
    .critique-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }

    .critique-card:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.1);
    }

    .critique-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }

    .critique-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 1rem;
    }

    .critique-author {
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .critique-date {
        font-size: 0.875rem;
        color: #888;
    }

    .critique-content {
        line-height: 1.6;
        margin-bottom: 1rem;
    }

    .critique-reactions {
        display: flex;
        gap: 0.75rem;
        margin-top: 1rem;
    }

    .reaction-badge {
        background: rgba(13, 110, 253, 0.2);
        color: #0d6efd;
        border: 1px solid rgba(13, 110, 253, 0.3);
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    /* Version Tab Styles */
    .version-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: flex-start;
        margin-bottom: 2rem;
    }

    .version-card {
        background: rgba(255, 255, 255, 0.03);
        border: 2px solid rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 180px;
        flex-shrink: 0;
    }

    .version-card:hover {
        border-color: rgba(13, 110, 253, 0.5);
        transform: translateY(-2px);
    }

    .version-card.current {
        border-color: #0d6efd;
        box-shadow: 0 0 20px rgba(13, 110, 253, 0.3);
    }

    .version-image {
        width: 100%;
        height: 160px;
        object-fit: cover;
        border-radius: 8px 8px 0 0;
    }

    .version-info {
        padding: 1rem;
    }

    .version-number {
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .version-date {
        font-size: 0.75rem;
        color: #888;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        #artwork-actions-bar {
            padding: 0.5rem 1rem;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .nav-tabs .nav-link {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
        }

        .artwork-info-grid {
            grid-template-columns: 1fr;
        }

        .version-grid {
            gap: 0.75rem;
        }
        
        .version-card {
            width: 140px;
        }
        
        .version-image {
            height: 120px;
        }
    }
</style>
{% endblock %}

{% block content %}

<!-- Focus Mode Section -->
<section id="focus-mode">
    <img id="focus-artwork" 
         src="{% if current_version and current_version.image %}{{ current_version.image.url }}{% elif current_version and current_version.image_url %}{{ current_version.image_url }}{% elif artwork.image %}{{ artwork.image.url }}{% elif artwork.image_url %}{{ artwork.image_url }}{% endif %}" 
         alt="{{ artwork.title }}" 
         onclick="enterFullscreen(this)">
    
    <!-- Enhanced Actions Bar -->
    <div id="artwork-actions-bar" class="d-flex align-items-center">
        <button class="btn btn-like" onclick="toggleFavorite({{ artwork.id }})" title="Add to Favorites" aria-label="Favorite">
            <span class="btn-icon">♥</span>
            Favorite
        </button>
        
        <a href="#tabbed-content" class="btn btn-outline-light" onclick="scrollToTabs()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-text btn-icon" viewBox="0 0 16 16">
                <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>
            </svg>
            See Details
        </a>
        
        <a href="{% url 'critique:create_critique' artwork.id %}" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil btn-icon" viewBox="0 0 16 16">
                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L5.707 14H2v-3.707L12.146.146zm3 3L13 5.293l-11 11V15h1.293l11-11z"/>
            </svg>
            Add Critique
        </a>
        
        <button class="btn btn-outline-light" onclick="enterFullscreen(document.getElementById('focus-artwork'))" title="Fullscreen View">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-fullscreen btn-icon" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z"/>
            </svg>
            Fullscreen
        </button>
    </div>
    
    <!-- Version Badge -->
    <div class="version-badge">
        v{{ current_version_number|default:"1" }} (Current)
    </div>
    
    <!-- Scroll Indicator -->
    <div class="scroll-indicator" onclick="scrollToTabs()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
        </svg>
    </div>
</section>

<!-- Tabbed Content Section -->
<div id="tabbed-content" class="container mt-5">
    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs justify-content-center" id="artworkTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#tab-info" type="button" role="tab" aria-controls="tab-info" aria-selected="true">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle me-2" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                </svg>
                Info
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="critiques-tab" data-bs-toggle="tab" data-bs-target="#tab-critiques" type="button" role="tab" aria-controls="tab-critiques" aria-selected="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-text me-2" viewBox="0 0 16 16">
                    <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                    <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>
                </svg>
                Critiques ({{ critiques.count }})
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="versions-tab" data-bs-toggle="tab" data-bs-target="#tab-versions" type="button" role="tab" aria-controls="tab-versions" aria-selected="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-collection me-2" viewBox="0 0 16 16">
                    <path d="M2.5 3.5a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-11zm2-2a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1h-7zM0 13a1.5 1.5 0 0 0 1.5 1.5h13A1.5 1.5 0 0 0 16 13V6a1.5 1.5 0 0 0-1.5-1.5h-13A1.5 1.5 0 0 0 0 6v7zm1.5.5A.5.5 0 0 1 1 13V6a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-13z"/>
                </svg>
                Versions ({{ versions.count|default:"0" }})
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="artworkTabContent">
        <!-- Info Tab -->
        <div class="tab-pane fade show active" id="tab-info" role="tabpanel" aria-labelledby="info-tab">
            <div class="p-4">
                <div class="artwork-info-grid">
                    <!-- Artwork Details -->
                    <div class="info-section">
                        <h3>Artwork Details</h3>
                        <div class="info-item">
                            <span class="info-label">Title</span>
                            <span class="info-value">{{ artwork.title }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Artist</span>
                            <span class="info-value">{{ artwork.author.username }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Created</span>
                            <span class="info-value">{{ artwork.created_at|date:"M d, Y" }}</span>
                        </div>
                        {% if artwork.category %}
                        <div class="info-item">
                            <span class="info-label">Category</span>
                            <span class="info-value">{{ artwork.category }}</span>
                        </div>
                        {% endif %}
                        <div class="info-item">
                            <span class="info-label">Current Version</span>
                            <span class="info-value">v{{ current_version_number|default:"1" }}</span>
                        </div>
                    </div>

                    <!-- Statistics -->
                    <div class="info-section">
                        <h3>Statistics</h3>
                        <div class="info-item">
                            <span class="info-label">Views</span>
                            <span class="info-value">{{ artwork.view_count|default:"0" }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Critiques</span>
                            <span class="info-value">{{ critiques.count }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Versions</span>
                            <span class="info-value">{{ versions.count|default:"1" }}</span>
                        </div>
                        {% if artwork.favorites_count %}
                        <div class="info-item">
                            <span class="info-label">Favorites</span>
                            <span class="info-value">{{ artwork.favorites_count }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% if artwork.description %}
                <div class="info-section">
                    <h3>Description</h3>
                    <p class="text-light">{{ artwork.description|linebreaks }}</p>
                </div>
                {% endif %}

                <!-- Quick Actions -->
                <div class="d-flex gap-3 mt-4">
                    <a href="{% url 'critique:create_critique' artwork.id %}" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle me-2" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                        Add Critique
                    </a>
                    <button class="btn btn-outline-light" onclick="toggleFavorite({{ artwork.id }})">
                        <span class="btn-icon">♥</span>
                        Favorite
                    </button>
                </div>
            </div>
        </div>

        <!-- Critiques Tab -->
        <div class="tab-pane fade" id="tab-critiques" role="tabpanel" aria-labelledby="critiques-tab">
            <div class="p-4">
                {% if critiques %}
                    {% for critique in critiques %}
                        <div class="critique-card">
                            <div class="critique-header">
                                <img src="{{ critique.author.profile.profile_image.url|default:'/static/img/default-avatar.svg' }}" 
                                     onerror="this.src='/static/img/default-avatar.svg'" 
                                     class="critique-avatar" alt="{{ critique.author.username }}">
                                <div>
                                    <div class="critique-author">{{ critique.author.username }}</div>
                                    <div class="critique-date">{{ critique.created_at|timesince }} ago</div>
                                </div>
                                {% if critique.average_rating %}
                                <div class="ms-auto">
                                    <span class="badge bg-primary">{{ critique.average_rating|floatformat:1 }}/10</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="critique-content">
                                {{ critique.content|linebreaks }}
                            </div>
                            {% if critique.helpful_count or critique.inspiring_count or critique.detailed_count %}
                            <div class="critique-reactions">
                                {% if critique.helpful_count %}
                                <span class="reaction-badge">{{ critique.helpful_count }} helpful</span>
                                {% endif %}
                                {% if critique.inspiring_count %}
                                <span class="reaction-badge">{{ critique.inspiring_count }} inspiring</span>
                                {% endif %}
                                {% if critique.detailed_count %}
                                <span class="reaction-badge">{{ critique.detailed_count }} detailed</span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-5">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-chat-text text-muted mb-3" viewBox="0 0 16 16">
                            <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
                            <path d="M4 5.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8zm0 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                        <h4 class="text-muted">No critiques yet</h4>
                        <p class="text-muted">Be the first to share your thoughts on this artwork.</p>
                        <a href="{% url 'critique:create_critique' artwork.id %}" class="btn btn-primary">
                            Add First Critique
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Versions Tab -->
        <div class="tab-pane fade" id="tab-versions" role="tabpanel" aria-labelledby="versions-tab">
            <div class="p-4">
                {% if versions %}
                    <div class="version-grid">
                        <!-- Current Version -->
                        <div class="version-card current" onclick="switchToCurrentVersion({{ artwork.id }})">
                            {% if current_version and current_version.image %}
                                <img src="{{ current_version.image.url }}" class="version-image" alt="Current Version">
                            {% elif current_version and current_version.image_url %}
                                <img src="{{ current_version.image_url }}" class="version-image" alt="Current Version">
                            {% elif artwork.image %}
                                <img src="{{ artwork.image.url }}" class="version-image" alt="Current Version">
                            {% elif artwork.image_url %}
                                <img src="{{ artwork.image_url }}" class="version-image" alt="Current Version">
                            {% endif %}
                            <div class="version-info">
                                <div class="version-number">v{{ current_version_number|default:"1" }} (Current)</div>
                                <div class="version-date">{{ artwork.created_at|date:"M d, Y" }}</div>
                            </div>
                        </div>
                        
                        <!-- Other Versions -->
                        {% for version in versions %}
                            {% if not version.is_archived %}
                            <div class="version-card" onclick="switchToVersion({{ version.id }})">
                                {% if version.image %}
                                    <img src="{{ version.image.url }}" class="version-image" alt="Version {{ version.version_number }}">
                                {% elif version.image_url %}
                                    <img src="{{ version.image_url }}" class="version-image" alt="Version {{ version.version_number }}">
                                {% endif %}
                                <div class="version-info">
                                    <div class="version-number">v{{ version.version_number }}</div>
                                    <div class="version-date">{{ version.created_at|date:"M d, Y" }}</div>
                                </div>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-collection text-muted mb-3" viewBox="0 0 16 16">
                            <path d="M2.5 3.5a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-11zm2-2a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1h-7zM0 13a1.5 1.5 0 0 0 1.5 1.5h13A1.5 1.5 0 0 0 16 13V6a1.5 1.5 0 0 0-1.5-1.5h-13A1.5 1.5 0 0 0 0 6v7zm1.5.5A.5.5 0 0 1 1 13V6a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-13z"/>
                        </svg>
                        <h4 class="text-muted">Single Version</h4>
                        <p class="text-muted">This artwork currently has only one version.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Focus Mode and Tabbed Layout Management
document.addEventListener('DOMContentLoaded', function() {
    initializeFocusMode();
    initializeTabNavigation();
});

function initializeFocusMode() {
    const focusMode = document.getElementById('focus-mode');
    const actionsBar = document.getElementById('artwork-actions-bar');
    
    if (!focusMode || !actionsBar) return;
    
    // Actions bar is already visible by default (no animation delays)
    actionsBar.style.opacity = '1';
}

function scrollToTabs() {
    const tabbedContent = document.getElementById('tabbed-content');
    if (tabbedContent) {
        tabbedContent.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    }
}

function initializeTabNavigation() {
    // Initialize Bootstrap tabs
    const triggerTabList = document.querySelectorAll('#artworkTab button[data-bs-toggle="tab"]');
    triggerTabList.forEach(triggerEl => {
        const tabTrigger = new bootstrap.Tab(triggerEl);
        
        triggerEl.addEventListener('click', event => {
            event.preventDefault();
            tabTrigger.show();
        });
    });
    
    // Handle tab changes for any special behavior
    document.addEventListener('shown.bs.tab', function (event) {
        const targetTab = event.target.getAttribute('data-bs-target');
        
        // Scroll to top of tab content when switching tabs
        const tabContent = document.querySelector(targetTab);
        if (tabContent) {
            tabContent.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
}

// Fullscreen functionality
function enterFullscreen(element) {
    if (element.requestFullscreen) {
        element.requestFullscreen();
    } else if (element.mozRequestFullScreen) {
        element.mozRequestFullScreen();
    } else if (element.webkitRequestFullscreen) {
        element.webkitRequestFullscreen();
    } else if (element.msRequestFullscreen) {
        element.msRequestFullscreen();
    }
}

// Version switching functionality
function switchToVersion(versionId) {
    // Update artwork image in focus mode
    const focusArtwork = document.getElementById('focus-artwork');
    
    // Make API call to get version data
    fetch(`/api/artworks/versions/${versionId}/`)
        .then(response => response.json())
        .then(data => {
            const imageUrl = data.image || data.image_url;
            if (imageUrl && focusArtwork) {
                focusArtwork.src = imageUrl;
                
                // Update version badge
                const versionBadge = document.querySelector('.version-badge');
                if (versionBadge && data.version_number) {
                    versionBadge.textContent = `v${data.version_number} (Current)`;
                }
                
                // Update version cards highlighting
                document.querySelectorAll('.version-card').forEach(card => {
                    card.classList.remove('current');
                });
                document.querySelector(`[onclick*="${versionId}"]`)?.classList.add('current');
                
                // Scroll back to focus mode to see the change
                document.getElementById('focus-mode').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        })
        .catch(error => {
            console.error('Error switching version:', error);
        });
}

function switchToCurrentVersion(artworkId) {
    // Switch back to main artwork
    location.reload(); // Simple approach - reload to show current state
}

// Favorite functionality
function toggleFavorite(artworkId) {
    fetch(`/api/artworks/${artworkId}/favorite/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        // Update all favorite buttons
        const btns = document.querySelectorAll('[onclick*="toggleFavorite"]');
        btns.forEach(btn => {
            if (data.favorited) {
                btn.innerHTML = btn.innerHTML.includes('♥') ? '♥ Favorited' : 'Favorited';
                btn.classList.remove('btn-outline-light');
                btn.classList.add('btn-danger');
            } else {
                btn.innerHTML = btn.innerHTML.includes('♥') ? '♥ Favorite' : 'Favorite';
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-outline-light');
            }
        });
    })
    .catch(error => {
        console.error('Error toggling favorite:', error);
    });
}

// CSRF token helper
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}