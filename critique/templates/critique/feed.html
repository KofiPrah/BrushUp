{% extends "critique/base.html" %}
{% load static %}

{% block title %}Critique Feed - BrushUp{% endblock %}

{% block extra_head %}
<style>
  /* --- Desktop look & feel --- */
  @media (min-width: 992px){
    body{ background: linear-gradient(135deg,#2c3e50 0%,#34495e 100%); color:#fff; }
    #quickbar{ display:none !important; } /* hide bottom bar on desktop */
  }
  #pair-container{ max-width:1200px; margin:0 auto; padding:20px; }
  .desktop-layout{ display:grid; grid-template-columns:2fr 1.2fr; gap:40px; align-items:start; }
  .spotlight-artwork,.counter-artwork{ border-radius:16px; overflow:hidden; box-shadow:0 12px 48px rgba(0,0,0,.35); background:#111; }
  .spotlight-artwork .ratio-lg{ aspect-ratio:4/3; position:relative; }
  .counter-artwork .ratio-sm{ aspect-ratio:16/10; position:relative; }
  .spotlight-artwork img,.counter-artwork img{ width:100%; height:100%; object-fit:cover; display:block; }

  .critique-interface{ background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:24px; backdrop-filter:blur(10px); }
  .critique-columns{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:24px; }
  .critique-column h6{ color:#bdc3c7; font-size:.9rem; text-transform:uppercase; margin-bottom:12px; }

  /* Chips (collapse with Show more) */
  .chips-wrap{ display:flex; flex-wrap:wrap; gap:8px; max-height:200px; overflow:hidden; position:relative; }
  .chips-wrap.is-expanded{ max-height:none; }
  .chips-fade{ position:absolute; left:0; right:0; bottom:0; height:48px; background:linear-gradient(to bottom,rgba(0,0,0,0),rgba(255,255,255,.05)); pointer-events:none; }
  .more-chips{ margin-top:8px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.2); color:#bdc3c7; padding:6px 12px; border-radius:12px; font-size:.8rem; }

  .tag-chip{ background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.25); color:#ecf0f1; padding:6px 12px; border-radius:16px; font-size:.82rem; cursor:pointer; }
  .tag-chip.selected{ background:#3498db; border-color:#2980b9; color:#fff; }
  .pro-chip.selected{ background:#27ae60; border-color:#219a52; }
  .con-chip.selected{ background:#e67e22; border-color:#c86b17; }

  /* Mobile container */
  @media (max-width: 991px){
    #pair-container{ padding:0 15px 120px; }
  }

  /* Quickbar (mobile) */
  #quickbar{
    position:fixed; left:0; right:0; bottom:0; z-index:1000;
    backdrop-filter:blur(10px); background:rgba(33,37,41,.95);
    border-top:1px solid rgba(255,255,255,.1); max-height:40vh; overflow-y:auto;
    padding:15px;
  }
  .chip-row{ max-height:120px; overflow-x:auto; overflow-y:hidden; }
</style>
{% endblock %}

{% block content %}

<!-- Desktop Layout -->
<div id="pair-container" class="desktop-layout">
  <!-- LEFT: Spotlight -->
  <section id="spotlight-desktop" class="spotlight-section">
    <div class="spotlight-artwork" data-artwork-id="">
      <div class="ratio-lg">
        <img id="spotlight-img-desktop" alt="Spotlight artwork" style="display:none;">
        <div class="loading-placeholder" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#bdc3c7;">
          <div class="spinner-border spinner-border-sm me-2" role="status"></div> Loading artwork...
        </div>
      </div>
    </div>
    <div class="card-body">
      <h5 id="spotlight-title-desktop" class="card-title mb-2"></h5>
      <p id="spotlight-caption-desktop" class="card-text text-muted small"></p>
      <div id="spotlight-meta-desktop" class="d-flex justify-content-between align-items-center text-muted small">
        <span id="spotlight-medium-desktop"></span>
        <span id="spotlight-date-desktop"></span>
      </div>
    </div>
  </section>

  <!-- RIGHT: Counter + Critique UI -->
  <section class="right-section">
    <div id="counter-desktop" class="counter-artwork" data-artwork-id="">
      <div class="ratio-sm">
        <img id="counter-img-desktop" alt="Counterpoint artwork" style="display:none;">
        <div class="loading-placeholder" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#bdc3c7;">
          <div class="spinner-border spinner-border-sm me-2" role="status"></div> Loading artwork...
        </div>
      </div>
      <div class="card-body">
        <h6 id="counter-title-desktop" class="card-title mb-2"></h6>
        <p id="counter-caption-desktop" class="card-text text-muted small"></p>
        <div id="counter-meta-desktop" class="d-flex justify-content-between align-items-center text-muted small">
          <span id="counter-medium-desktop"></span>
          <span id="counter-date-desktop"></span>
        </div>
      </div>
    </div>

    <div class="critique-interface">
      <div class="critique-columns">
        <div class="critique-column">
          <h6>Strengths</h6>
          <div id="pro-tags" class="chips-wrap"></div>
          <div class="chips-fade"></div>
          <button id="pro-more" class="more-chips" style="display:none;">Show more</button>
        </div>
        <div class="critique-column">
          <h6>Your Feedback</h6>
          <textarea id="general-feedback" class="form-control mb-2" rows="4" placeholder="Share a specific suggestion..."></textarea>
          <div class="d-flex gap-2">
            <button id="desktop-submit-btn" class="btn btn-primary">Submit</button>
            <button id="desktop-swap-btn" class="btn btn-outline-secondary">Swap</button>
            <button id="desktop-next-btn" class="btn btn-outline-secondary ms-auto" disabled>Next â†’</button>
          </div>
        </div>
        <div class="critique-column">
          <h6>Opportunities</h6>
          <div
