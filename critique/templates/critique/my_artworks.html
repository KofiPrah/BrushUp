{% extends "critique/base.html" %}

{% block title %}Artist Studio - My Artworks{% endblock %}

{% block extra_css %}
<style>
/* Studio Workspace Styling */
.studio-filters-panel {
    background: linear-gradient(135deg, #343a40 0%, #495057 100%) !important;
    border: 1px solid #495057 !important;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3) !important;
}

.studio-filters-panel .form-label {
    color: #ffffff;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.studio-filters-panel .form-control,
.studio-filters-panel .form-select {
    background-color: #495057;
    border: 2px solid #6c757d;
    color: #ffffff;
    transition: all 0.2s ease;
}

.studio-filters-panel .form-control:focus,
.studio-filters-panel .form-select:focus {
    background-color: #495057;
    border-color: #0d6efd;
    color: #ffffff;
    box-shadow: 0 0 0 0.2rem rgba(13,110,253,0.25);
}

.studio-filters-panel .form-control::placeholder {
    color: #adb5bd;
}

.studio-filters-panel .form-select option {
    background-color: #495057;
    color: #ffffff;
}

.studio-filters-panel .border-primary {
    border-color: #0d6efd !important;
}

.artwork-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: 1px solid #e0e0e0;
    position: relative;
    overflow: hidden;
}

.artwork-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.artwork-card:hover .quick-actions {
    opacity: 1;
    visibility: visible;
}

.quick-actions {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(8px);
    border-radius: 0 0 0.375rem 0.375rem;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 10;
}

.artwork-image-container {
    position: relative;
    overflow: hidden;
}

.artwork-image-container:hover .quick-actions {
    opacity: 1;
    visibility: visible;
}

.edit-icon {
    opacity: 0;
    transition: opacity 0.2s ease;
}

.artwork-title:hover .edit-icon,
.artwork-description:hover .edit-icon,
.artwork-tags:hover .edit-icon {
    opacity: 0.7;
}

.artwork-title,
.artwork-description,
.artwork-tags {
    cursor: pointer;
    padding: 2px 4px;
    border-radius: 4px;
    transition: background-color 0.2s ease;
}

.artwork-title:hover,
.artwork-description:hover,
.artwork-tags:hover {
    background-color: rgba(0,123,255,0.1);
}

.artwork-checkbox {
    background: rgba(255,255,255,0.9);
    border-radius: 8px;
    z-index: 1000;
    backdrop-filter: blur(4px);
    border: 1px solid rgba(0,0,0,0.1);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    width: 40px !important;
    height: 40px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

.artwork-checkbox.bulk-hidden {
    display: none !important;
}

.artwork-checkbox.bulk-visible {
    display: block !important;
}

.artwork-checkbox .form-check-input {
    margin: 0 !important;
    width: 20px !important;
    height: 20px !important;
    opacity: 1 !important;
    position: relative !important;
    z-index: 9999 !important;
    transform: scale(1.2) !important;
    appearance: auto !important;
    -webkit-appearance: checkbox !important;
    -moz-appearance: checkbox !important;
}

.badge {
    font-size: 0.7rem;
    letter-spacing: 0.5px;
}

/* Studio Statistics */
.border-end.border-light {
    border-color: rgba(255,255,255,0.3) !important;
}

/* Filter buttons */
.btn-outline-primary:hover,
.btn-outline-success:hover,
.btn-outline-warning:hover,
.btn-outline-info:hover {
    transform: translateY(-1px);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .d-flex.gap-2 {
        flex-wrap: wrap;
    }
    
    .quick-actions {
        padding: 1rem !important;
    }
    
    .position-absolute.top-0.end-0 {
        position: relative !important;
        top: auto !important;
        end: auto !important;
        padding: 0.5rem !important;
        margin-bottom: 0.5rem;
    }
}

/* Loading states */
.loading {
    opacity: 0.6;
    pointer-events: none;
}

/* Success/Error states */
.status-success {
    border-left: 4px solid #28a745;
}

.status-error {
    border-left: 4px solid #dc3545;
}

/* Active filter indicator */
.filter-active {
    background-color: #0d6efd !important;
    color: white !important;
}
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-dark text-white">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-palette me-2" viewBox="0 0 16 16">
                        <path d="M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
                        <path d="M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8z"/>
                    </svg>
                    Artist Studio - My Artworks
                </h2>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-light btn-sm" onclick="toggleBulkActions()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square" viewBox="0 0 16 16">
                            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                            <path d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"/>
                        </svg>
                        Bulk Actions
                    </button>
                    <a href="{% url 'critique:artwork_upload' %}" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle me-2" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                        New Artwork
                    </a>
                </div>
            </div>
            
            <!-- Studio Statistics -->
            <div class="row text-center">
                <div class="col-6 col-md-3">
                    <div class="border-end border-light">
                        <h5 class="mb-0" id="total-artworks">{{ artworks.count|default:0 }}</h5>
                        <small class="text-light">Total Pieces</small>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="border-end border-light">
                        <h5 class="mb-0" id="draft-count">0</h5>
                        <small class="text-light">Drafts</small>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="border-end border-light">
                        <h5 class="mb-0" id="seeking-critique-count">0</h5>
                        <small class="text-light">Seeking Critique</small>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <h5 class="mb-0" id="total-interactions">0</h5>
                    <small class="text-light">Total Interactions</small>
                </div>
            </div>
        </div>
        
        <div class="card-body">
            <!-- Advanced Studio Filters -->
            <div class="studio-filters-panel p-4 rounded-3 shadow-sm mb-4">
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <label class="form-label fw-semibold text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search me-1" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                            Search & Filter
                        </label>
                        <div class="input-group">
                            <input type="text" id="searchInput" class="form-control border-primary" placeholder="Search by title, tags, or description...">
                            <button class="btn btn-primary" type="button" id="searchButton">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="col-md-2">
                        <label class="form-label fw-semibold text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-text me-1" viewBox="0 0 16 16">
                                <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                                <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                            </svg>
                            Status
                        </label>
                        <select id="statusFilter" class="form-select border-primary">
                            <option value="all">All Status</option>
                            <option value="draft">Drafts Only</option>
                            <option value="published">Published</option>
                        </select>
                    </div>
                    
                    <div class="col-md-2">
                        <label class="form-label fw-semibold text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye me-1" viewBox="0 0 16 16">
                                <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                                <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                            </svg>
                            Visibility
                        </label>
                        <select id="visibilityFilter" class="form-select border-primary">
                            <option value="all">All Visibility</option>
                            <option value="public">Public</option>
                            <option value="private">Private</option>
                            <option value="unlisted">Unlisted</option>
                        </select>
                    </div>
                    
                    <div class="col-md-2">
                        <label class="form-label fw-semibold text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-dots me-1" viewBox="0 0 16 16">
                                <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                                <path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
                            </svg>
                            Critique Status
                        </label>
                        <select id="critiqueFilter" class="form-select border-primary">
                            <option value="all">All</option>
                            <option value="seeking">Seeking Critique</option>
                            <option value="not_seeking">Not Seeking</option>
                        </select>
                    </div>
                    
                    <div class="col-md-2">
                        <label class="form-label fw-semibold text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sort-down me-1" viewBox="0 0 16 16">
                                <path d="M3.5 2.5a.5.5 0 0 0-1 0v8.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L3.5 11.293V2.5zm3.5 1a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM7.5 6a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zm0 3a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3zm0 3a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1z"/>
                            </svg>
                            Sort By
                        </label>
                        <select id="sortDropdown" class="form-select border-primary">
                            <option value="newest">Recent First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="most_likes">Most Popular</option>
                            <option value="most_critiques">Most Critiques</option>
                            <option value="title_asc">Title (A-Z)</option>
                            <option value="title_desc">Title (Z-A)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Quick Action Buttons -->
                <div class="d-flex gap-2 flex-wrap">
                    <button class="btn btn-sm btn-outline-primary" onclick="filterByTag('recent')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-clock me-1" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                        </svg>
                        Last 7 Days
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="filterByCritiques('active')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-chat-dots me-1" viewBox="0 0 16 16">
                            <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                            <path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
                        </svg>
                        Active Critiques
                    </button>
                    <button class="btn btn-sm btn-outline-warning" onclick="showDraftsOnly()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-file-earmark-text me-1" viewBox="0 0 16 16">
                            <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                            <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                        </svg>
                        Drafts Only
                    </button>
                    <button class="btn btn-sm btn-outline-info" onclick="clearAllFilters()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-arrow-clockwise me-1" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                        </svg>
                        Clear Filters
                    </button>
                </div>
            </div>
            
            {% if artworks %}
                <!-- Bulk Actions Bar (Hidden by default) -->
                <div id="bulk-actions-bar" class="alert alert-info d-none mb-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <span><span id="selected-count">0</span> artworks selected</span>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-success" onclick="bulkPublish()">Publish Selected</button>
                            <button class="btn btn-sm btn-warning" onclick="bulkDraft()">Mark as Draft</button>
                            <button class="btn btn-sm btn-info" onclick="bulkToggleCritique()">Toggle Critique Requests</button>
                            <button class="btn btn-sm btn-danger" onclick="bulkDelete()">Delete Selected</button>
                            <button class="btn btn-sm btn-secondary" onclick="cancelBulkActions()">Cancel</button>
                        </div>
                    </div>
                </div>

                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="artworksContainer">
                    {% for artwork in artworks %}
                        <div class="col artwork-item" data-artwork-id="{{ artwork.id }}" 
                             data-status="{% if artwork.is_published %}published{% else %}draft{% endif %}"
                             data-visibility="{{ artwork.visibility|default:'public' }}"
                             data-seeking-critique="{% if artwork.seeking_critique %}true{% else %}false{% endif %}">
                            <div class="card h-100 position-relative artwork-card">
                                <!-- Bulk Selection Checkbox -->
                                <div class="artwork-checkbox position-absolute top-0 start-0 p-2 d-none bulk-hidden">
                                    <input type="checkbox" 
                                           class="form-check-input" 
                                           id="checkbox-{{ artwork.id }}"
                                           name="artwork_selection"
                                           value="{{ artwork.id }}"
                                           onchange="toggleArtworkSelection({{ artwork.id }}, this)">
                                </div>
                                
                                <!-- Status Indicators -->
                                <div class="position-absolute top-0 end-0 p-2">
                                    <div class="d-flex flex-column gap-1">
                                        {% if not artwork.is_published %}
                                            <span class="badge bg-warning text-dark">DRAFT</span>
                                        {% endif %}
                                        {% if artwork.visibility == 'private' %}
                                            <span class="badge bg-dark">PRIVATE</span>
                                        {% elif artwork.visibility == 'unlisted' %}
                                            <span class="badge bg-secondary">UNLISTED</span>
                                        {% endif %}
                                        {% if artwork.seeking_critique %}
                                            <span class="badge bg-success">SEEKING CRITIQUE</span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- Image Container -->
                                <div class="position-relative" style="z-index: 1;">
                                    <a href="{% url 'critique:artwork_detail' artwork.id %}" style="z-index: 1;">
                                        {% if artwork.image %}
                                            <img src="{{ artwork.image.url }}" class="card-img-top" alt="{{ artwork.title }}" style="height: 200px; object-fit: cover; z-index: 1;">
                                        {% elif artwork.image_url %}
                                            <img src="{{ artwork.image_url }}" class="card-img-top" alt="{{ artwork.title }}" style="height: 200px; object-fit: cover; z-index: 1;">
                                        {% else %}
                                            <div class="bg-secondary text-white d-flex justify-content-center align-items-center" style="height: 200px; z-index: 1;">
                                                <span>No Image</span>
                                            </div>
                                        {% endif %}
                                    </a>
                                    
                                    <!-- Quick Action Overlay -->
                                    <div class="position-absolute bottom-0 start-0 end-0 bg-dark bg-opacity-75 text-white p-2 quick-actions" style="opacity: 0; transition: opacity 0.3s;">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="d-flex gap-1">
                                                <button class="btn btn-sm btn-outline-light" onclick="togglePublishStatus({{ artwork.id }})" title="Toggle Publish Status">
                                                    {% if artwork.is_published %}
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
                                                            <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/>
                                                            <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/>
                                                            <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>
                                                        </svg>
                                                    {% else %}
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                                                            <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                                                            <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                                                        </svg>
                                                    {% endif %}
                                                </button>
                                                <button class="btn btn-sm btn-outline-light" onclick="toggleCritiqueRequest({{ artwork.id }})" title="Toggle Critique Request">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-chat-dots" viewBox="0 0 16 16">
                                                        <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                                                        <path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="d-flex gap-1">
                                                <button class="btn btn-sm btn-outline-light" onclick="openQuickEdit({{ artwork.id }})" title="Quick Edit">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                                                        <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 8.207l-3-3L12.146.146zM11.207 9l-3-3L2.5 11.707V15h3.293L11.207 9zM13 2.5a.5.5 0 0 0-.5-.5h-2.797l-1.5 1.5h3.797V2.5z"/>
                                                    </svg>
                                                </button>
                                                <a href="{% url 'critique:artwork_detail' artwork.id %}" class="btn btn-sm btn-outline-light" title="View Details">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                                                        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                                                    </svg>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Card Body with Inline Editing -->
                                <div class="card-body">
                                    <!-- Editable Title -->
                                    <h5 class="card-title artwork-title" data-artwork-id="{{ artwork.id }}" onclick="enableInlineEdit(this, 'title')">
                                        {{ artwork.title }}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-pencil ms-1 edit-icon" viewBox="0 0 16 16">
                                            <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 8.207l-3-3L12.146.146zM11.207 9l-3-3L2.5 11.707V15h3.293L11.207 9zM13 2.5a.5.5 0 0 0-.5-.5h-2.797l-1.5 1.5h3.797V2.5z"/>
                                        </svg>
                                    </h5>
                                    
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <small class="text-muted">{{ artwork.created_at|date:"M d, Y" }}</small>
                                        <div class="d-flex align-items-center gap-2">
                                            <small class="text-muted">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-heart me-1" viewBox="0 0 16 16">
                                                    <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                                                </svg>
                                                {{ artwork.total_likes|default:0 }}
                                            </small>
                                            <small class="text-muted">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-chat-dots me-1" viewBox="0 0 16 16">
                                                    <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                                                    <path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
                                                </svg>
                                                {{ artwork.critique_count|default:0 }}
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <!-- Editable Description -->
                                    <p class="card-text artwork-description" data-artwork-id="{{ artwork.id }}" onclick="enableInlineEdit(this, 'description')">
                                        {{ artwork.description|truncatechars:120|default:"Click to add description..." }}
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-pencil ms-1 edit-icon" viewBox="0 0 16 16">
                                            <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 8.207l-3-3L12.146.146zM11.207 9l-3-3L2.5 11.707V15h3.293L11.207 9zM13 2.5a.5.5 0 0 0-.5-.5h-2.797l-1.5 1.5h3.797V2.5z"/>
                                        </svg>
                                    </p>
                                    
                                    <!-- Tags Section -->
                                    <div class="mb-2">
                                        <div class="artwork-tags" data-artwork-id="{{ artwork.id }}" onclick="enableInlineEdit(this, 'tags')">
                                            {% if artwork.tags %}
                                                {% for tag in artwork.tags_list|slice:":4" %}
                                                    <span class="badge bg-primary me-1">{{ tag }}</span>
                                                {% endfor %}
                                                {% if artwork.tags_list|length > 4 %}
                                                    <span class="badge bg-secondary">+{{ artwork.tags_list|length|add:"-4" }} more</span>
                                                {% endif %}
                                            {% else %}
                                                <span class="text-muted small">Click to add tags...</span>
                                            {% endif %}
                                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-pencil ms-1 edit-icon" viewBox="0 0 16 16">
                                                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 8.207l-3-3L12.146.146zM11.207 9l-3-3L2.5 11.707V15h3.293L11.207 9zM13 2.5a.5.5 0 0 0-.5-.5h-2.797l-1.5 1.5h3.797V2.5z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    
                                    <!-- Medium Badge -->
                                    {% if artwork.medium %}
                                        <span class="badge bg-secondary">{{ artwork.medium }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                {% if is_paginated %}
                <nav aria-label="Page navigation" class="mt-5">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1" aria-label="First">
                                    <span aria-hidden="true">&laquo;&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="First">
                                    <span aria-hidden="true">&laquo;&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                        {% endif %}
                        
                        {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                                <li class="page-item active">
                                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                </li>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}
                        
                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Last">
                                    <span aria-hidden="true">&raquo;&raquo;</span>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Last">
                                    <span aria-hidden="true">&raquo;&raquo;</span>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
                
            {% else %}
                <div class="alert alert-info text-center py-5">
                    <h4 class="mb-3">You haven't uploaded any artworks yet</h4>
                    <p>Share your creative work with the community to receive valuable feedback and appreciation!</p>
                    <a href="{% url 'critique:artwork_upload' %}" class="btn btn-lg btn-primary mt-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload me-2" viewBox="0 0 16 16">
                            <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                            <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                        </svg>
                        Upload Your First Artwork
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
let bulkActionsMode = false;
let selectedArtworks = new Set();

document.addEventListener('DOMContentLoaded', function() {
    initializeStudioWorkspace();
    calculateStatistics();
    setupEventListeners();
    setupHoverEffects();
});

function initializeStudioWorkspace() {
    console.log('Initializing Artist Studio Workspace...');
    
    // Load user preferences from localStorage
    const savedFilters = localStorage.getItem('studio_filters');
    if (savedFilters) {
        const filters = JSON.parse(savedFilters);
        applyFilters(filters);
    }
}

function calculateStatistics() {
    const artworkItems = document.querySelectorAll('.artwork-item');
    let totalArtworks = artworkItems.length;
    let draftCount = 0;
    let seekingCritiqueCount = 0;
    let totalInteractions = 0;
    
    artworkItems.forEach(item => {
        if (item.dataset.status === 'draft') draftCount++;
        if (item.dataset.seekingCritique === 'true') seekingCritiqueCount++;
        
        const likes = parseInt(item.querySelector('.bi-heart').parentElement.textContent.match(/\d+/)?.[0] || 0);
        const critiques = parseInt(item.querySelector('.bi-chat-dots').parentElement.textContent.match(/\d+/)?.[0] || 0);
        totalInteractions += likes + critiques;
    });
    
    document.getElementById('total-artworks').textContent = totalArtworks;
    document.getElementById('draft-count').textContent = draftCount;
    document.getElementById('seeking-critique-count').textContent = seekingCritiqueCount;
    document.getElementById('total-interactions').textContent = totalInteractions;
}

function setupEventListeners() {
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    const visibilityFilter = document.getElementById('visibilityFilter');
    const critiqueFilter = document.getElementById('critiqueFilter');
    const sortDropdown = document.getElementById('sortDropdown');
    
    // Advanced search and filtering
    [searchInput, statusFilter, visibilityFilter, critiqueFilter, sortDropdown].forEach(element => {
        if (element) {
            element.addEventListener('change', applyFiltersAndSort);
            element.addEventListener('input', applyFiltersAndSort);
        }
    });
    
    // Search on Enter key
    if (searchInput) {
        searchInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                applyFiltersAndSort();
            }
        });
    }
}

function setupHoverEffects() {
    // Show quick actions on hover
    document.querySelectorAll('.artwork-card').forEach(card => {
        const quickActions = card.querySelector('.quick-actions');
        if (quickActions) {
            card.addEventListener('mouseenter', () => {
                quickActions.style.opacity = '1';
            });
            card.addEventListener('mouseleave', () => {
                quickActions.style.opacity = '0';
            });
        }
    });
}

function applyFiltersAndSort() {
    const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
    const statusFilter = document.getElementById('statusFilter')?.value || 'all';
    const visibilityFilter = document.getElementById('visibilityFilter')?.value || 'all';
    const critiqueFilter = document.getElementById('critiqueFilter')?.value || 'all';
    const sortBy = document.getElementById('sortDropdown')?.value || 'newest';
    
    const artworkItems = Array.from(document.querySelectorAll('.artwork-item'));
    
    // Apply filters
    artworkItems.forEach(item => {
        let visible = true;
        
        // Search filter
        if (searchTerm) {
            const title = item.querySelector('.artwork-title').textContent.toLowerCase();
            const description = item.querySelector('.artwork-description').textContent.toLowerCase();
            const tags = item.querySelector('.artwork-tags').textContent.toLowerCase();
            
            visible = visible && (title.includes(searchTerm) || description.includes(searchTerm) || tags.includes(searchTerm));
        }
        
        // Status filter
        if (statusFilter !== 'all') {
            visible = visible && item.dataset.status === statusFilter;
        }
        
        // Visibility filter
        if (visibilityFilter !== 'all') {
            visible = visible && item.dataset.visibility === visibilityFilter;
        }
        
        // Critique filter
        if (critiqueFilter !== 'all') {
            const seekingCritique = item.dataset.seekingCritique === 'true';
            visible = visible && ((critiqueFilter === 'seeking' && seekingCritique) || (critiqueFilter === 'not_seeking' && !seekingCritique));
        }
        
        item.style.display = visible ? '' : 'none';
    });
    
    // Apply sorting
    const visibleItems = artworkItems.filter(item => item.style.display !== 'none');
    sortArtworks(visibleItems, sortBy);
    
    // Save filters to localStorage
    const filters = { searchTerm, statusFilter, visibilityFilter, critiqueFilter, sortBy };
    localStorage.setItem('studio_filters', JSON.stringify(filters));
}

function sortArtworks(items, sortBy) {
    const container = document.getElementById('artworksContainer');
    
    items.sort((a, b) => {
        const titleA = a.querySelector('.artwork-title').textContent.trim();
        const titleB = b.querySelector('.artwork-title').textContent.trim();
        
        const dateA = new Date(a.querySelector('.text-muted').textContent);
        const dateB = new Date(b.querySelector('.text-muted').textContent);
        
        const likesA = parseInt(a.querySelector('.bi-heart').parentElement.textContent.match(/\d+/)?.[0] || 0);
        const likesB = parseInt(b.querySelector('.bi-heart').parentElement.textContent.match(/\d+/)?.[0] || 0);
        
        const critiquesA = parseInt(a.querySelector('.bi-chat-dots').parentElement.textContent.match(/\d+/)?.[0] || 0);
        const critiquesB = parseInt(b.querySelector('.bi-chat-dots').parentElement.textContent.match(/\d+/)?.[0] || 0);
        
        switch(sortBy) {
            case 'newest':
                return dateB - dateA;
            case 'oldest':
                return dateA - dateB;
            case 'most_likes':
                return likesB - likesA;
            case 'most_critiques':
                return critiquesB - critiquesA;
            case 'title_asc':
                return titleA.localeCompare(titleB);
            case 'title_desc':
                return titleB.localeCompare(titleA);
            default:
                return 0;
        }
    });
    
    // Re-append sorted items
    items.forEach(item => {
        container.appendChild(item);
    });
}

// Quick filter functions
function filterByTag(tag) {
    const searchInput = document.getElementById('searchInput');
    if (tag === 'recent') {
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        
        document.querySelectorAll('.artwork-item').forEach(item => {
            const dateText = item.querySelector('.text-muted').textContent;
            const itemDate = new Date(dateText);
            item.style.display = itemDate >= weekAgo ? '' : 'none';
        });
    }
}

function filterByCritiques(type) {
    document.getElementById('critiqueFilter').value = type === 'active' ? 'seeking' : 'all';
    applyFiltersAndSort();
}

function showDraftsOnly() {
    document.getElementById('statusFilter').value = 'draft';
    applyFiltersAndSort();
}

function clearAllFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('statusFilter').value = 'all';
    document.getElementById('visibilityFilter').value = 'all';
    document.getElementById('critiqueFilter').value = 'all';
    document.getElementById('sortDropdown').value = 'newest';
    
    document.querySelectorAll('.artwork-item').forEach(item => {
        item.style.display = '';
    });
    
    localStorage.removeItem('studio_filters');
}

// Bulk Actions (remove duplicate declaration)
bulkSelectionMode = false;

// Ensure function is available after DOM loads
document.addEventListener('DOMContentLoaded', function() {
    window.toggleBulkActions = function() {
    console.log('toggleBulkActions called, current mode:', bulkSelectionMode);
    bulkSelectionMode = !bulkSelectionMode;
    const checkboxes = document.querySelectorAll('.artwork-checkbox');
    const bulkBar = document.getElementById('bulk-actions-bar');
    const toggleBtn = document.querySelector('[onclick="toggleBulkActions()"]');
    
    console.log('Found checkboxes:', checkboxes.length);
    console.log('Bulk bar element:', bulkBar);
    console.log('Toggle button:', toggleBtn);
    
    if (bulkSelectionMode) {
        console.log('Enabling bulk selection mode');
        checkboxes.forEach((cb, index) => {
            console.log(`Setting checkbox ${index} to visible`);
            cb.classList.remove('bulk-hidden', 'd-none');
            cb.classList.add('bulk-visible');
            cb.style.setProperty('display', 'block', 'important');
            
            const input = cb.querySelector('input[type="checkbox"]');
            if (input) {
                input.style.setProperty('opacity', '1', 'important');
                input.style.setProperty('width', '20px', 'important');
                input.style.setProperty('height', '20px', 'important');
                input.style.setProperty('z-index', '9999', 'important');
                input.style.setProperty('position', 'relative', 'important');
                input.style.setProperty('appearance', 'auto', 'important');
                console.log('Checkbox input styled:', input);
            }
        });
        if (bulkBar) bulkBar.classList.remove('d-none');
        if (toggleBtn) {
            toggleBtn.classList.add('active');
            toggleBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-square" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg> Cancel';
        }
    } else {
        console.log('Disabling bulk selection mode');
        cancelBulkActions();
    }
    };

    window.toggleArtworkSelection = function(artworkId, checkbox) {
        if (checkbox.checked) {
            selectedArtworks.add(artworkId);
        } else {
            selectedArtworks.delete(artworkId);
        }
        updateSelectedCount();
    };

    window.updateSelectedCount = function() {
        document.getElementById('selected-count').textContent = selectedArtworks.size;
    };

    window.cancelBulkActions = function() {
        bulkSelectionMode = false;
        selectedArtworks.clear();
        
        const checkboxes = document.querySelectorAll('.artwork-checkbox');
        const bulkBar = document.getElementById('bulk-actions-bar');
        const toggleBtn = document.querySelector('[onclick="toggleBulkActions()"]');
        
        checkboxes.forEach(cb => {
            cb.classList.remove('bulk-visible');
            cb.classList.add('bulk-hidden', 'd-none');
            const input = cb.querySelector('input');
            if (input) input.checked = false;
        });
        
        bulkBar.classList.add('d-none');
        toggleBtn.classList.remove('active');
        toggleBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"/></svg> Bulk Actions';
        
        updateSelectedCount();
    };
});

// Individual Artwork Actions
function togglePublishStatus(artworkId) {
    const artworkItem = document.querySelector(`[data-artwork-id="${artworkId}"]`);
    const currentStatus = artworkItem.dataset.status;
    
    // Make API call to toggle publish status
    fetch(`/api/artworks/${artworkId}/toggle_publish_status/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.id) {
            const newStatus = data.status;
            artworkItem.dataset.status = newStatus;
            updateStatusBadges(artworkItem, newStatus);
            calculateStatistics();
            
            // Show success feedback
            showToast(`Artwork ${newStatus === 'published' ? 'published' : 'saved as draft'}`, 'success');
        } else {
            showToast('Failed to update status', 'error');
        }
    })
    .catch(error => {
        console.error('Error toggling publish status:', error);
        showToast('Failed to update status', 'error');
    });
}

function toggleCritiqueRequest(artworkId) {
    const artworkItem = document.querySelector(`[data-artwork-id="${artworkId}"]`);
    
    // Make API call to toggle critique request
    fetch(`/api/artworks/${artworkId}/toggle_critique_request/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.id !== undefined) {
            const newSeeking = data.seeking_critique;
            artworkItem.dataset.seekingCritique = newSeeking.toString();
            updateCritiqueBadge(artworkItem, newSeeking);
            calculateStatistics();
            
            // Show success feedback
            showToast(`Critique requests ${newSeeking ? 'enabled' : 'disabled'}`, 'success');
        } else {
            showToast('Failed to update critique request', 'error');
        }
    })
    .catch(error => {
        console.error('Error toggling critique request:', error);
        showToast('Failed to update critique request', 'error');
    });
}

function updateStatusBadges(artworkItem, status) {
    const statusContainer = artworkItem.querySelector('.position-absolute.top-0.end-0');
    const draftBadge = statusContainer.querySelector('.badge.bg-warning');
    
    if (status === 'draft') {
        if (!draftBadge) {
            const badge = document.createElement('span');
            badge.className = 'badge bg-warning text-dark';
            badge.textContent = 'DRAFT';
            statusContainer.querySelector('.d-flex').appendChild(badge);
        }
    } else {
        if (draftBadge) {
            draftBadge.remove();
        }
    }
    
    // Update the publish/draft button icon in quick actions
    const publishButton = artworkItem.querySelector('[onclick^="togglePublishStatus"]');
    if (publishButton) {
        const icon = publishButton.querySelector('svg');
        icon.innerHTML = status === 'published' ? 
            '<path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/><path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/><path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>' :
            '<path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/><path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>';
    }
}

// Quick Edit Modal/Popup functionality
function openQuickEdit(artworkId) {
    const artworkItem = document.querySelector(`[data-artwork-id="${artworkId}"]`);
    const title = artworkItem.querySelector('.artwork-title').textContent.trim();
    const description = artworkItem.querySelector('.artwork-description').textContent.trim();
    const visibility = artworkItem.dataset.visibility;
    
    // Create quick edit modal
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'quickEditModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Quick Edit Artwork</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="quickEditForm">
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" id="editTitle" value="${title}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="editDescription" rows="4">${description.includes('Click to add') ? '' : description}</textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Visibility</label>
                            <select class="form-select" id="editVisibility">
                                <option value="public" ${visibility === 'public' ? 'selected' : ''}>Public</option>
                                <option value="private" ${visibility === 'private' ? 'selected' : ''}>Private</option>
                                <option value="unlisted" ${visibility === 'unlisted' ? 'selected' : ''}>Unlisted</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveQuickEdit(${artworkId})">Save Changes</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    // Remove modal from DOM when closed
    modal.addEventListener('hidden.bs.modal', () => {
        modal.remove();
    });
}

function saveQuickEdit(artworkId) {
    const title = document.getElementById('editTitle').value.trim();
    const description = document.getElementById('editDescription').value.trim();
    const visibility = document.getElementById('editVisibility').value;
    
    const updateData = {
        title: title,
        description: description,
        visibility: visibility
    };
    
    fetch(`/api/artworks/${artworkId}/`, {
        method: 'PATCH',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(updateData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.id) {
            const artworkItem = document.querySelector(`[data-artwork-id="${artworkId}"]`);
            
            // Update title
            artworkItem.querySelector('.artwork-title').firstChild.textContent = title;
            
            // Update description
            const descElement = artworkItem.querySelector('.artwork-description');
            descElement.firstChild.textContent = description || 'Click to add description...';
            
            // Update visibility
            artworkItem.dataset.visibility = visibility;
            updateVisibilityBadge(artworkItem, visibility);
            
            calculateStatistics();
            showToast('Artwork updated successfully', 'success');
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('quickEditModal'));
            modal.hide();
        } else {
            showToast('Failed to update artwork', 'error');
        }
    })
    .catch(error => {
        console.error('Error updating artwork:', error);
        showToast('Failed to update artwork', 'error');
    });
}

function updateCritiqueBadge(artworkItem, seeking) {
    const statusContainer = artworkItem.querySelector('.position-absolute.top-0.end-0');
    const critiqueBadge = statusContainer.querySelector('.badge.bg-success');
    
    if (seeking) {
        if (!critiqueBadge) {
            const badge = document.createElement('span');
            badge.className = 'badge bg-success';
            badge.textContent = 'SEEKING CRITIQUE';
            statusContainer.querySelector('.d-flex').appendChild(badge);
        }
    } else {
        if (critiqueBadge) {
            critiqueBadge.remove();
        }
    }
    
    // Update the button icon in quick actions
    const quickActionsButton = artworkItem.querySelector('[onclick^="toggleCritiqueRequest"]');
    if (quickActionsButton) {
        const icon = quickActionsButton.querySelector('svg');
        if (seeking) {
            icon.classList.add('text-success');
        } else {
            icon.classList.remove('text-success');
        }
    }
}

function changeVisibility(artworkId, newVisibility) {
    const artworkItem = document.querySelector(`[data-artwork-id="${artworkId}"]`);
    
    fetch(`/api/artworks/${artworkId}/`, {
        method: 'PATCH',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            visibility: newVisibility
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.id) {
            artworkItem.dataset.visibility = newVisibility;
            updateVisibilityBadge(artworkItem, newVisibility);
            calculateStatistics();
            showToast(`Visibility changed to ${newVisibility}`, 'success');
        } else {
            showToast('Failed to update visibility', 'error');
        }
    })
    .catch(error => {
        console.error('Error updating visibility:', error);
        showToast('Failed to update visibility', 'error');
    });
}

function updateVisibilityBadge(artworkItem, visibility) {
    const statusContainer = artworkItem.querySelector('.position-absolute.top-0.end-0');
    let visibilityBadge = statusContainer.querySelector('.badge.bg-info');
    
    // Remove existing visibility badge
    if (visibilityBadge) {
        visibilityBadge.remove();
    }
    
    // Add new visibility badge if not public
    if (visibility !== 'public') {
        const badge = document.createElement('span');
        badge.className = 'badge bg-info';
        badge.textContent = visibility.toUpperCase();
        statusContainer.querySelector('.d-flex').appendChild(badge);
    }
}

// Inline Editing
function enableInlineEdit(element, fieldType) {
    const artworkCard = element.closest('.artwork-item');
    const artworkId = artworkCard.dataset.artworkId;
    const currentValue = element.textContent.trim().replace(/\s*/, ''); // Remove edit icon
    
    // Create input element
    let inputElement;
    if (fieldType === 'description') {
        inputElement = document.createElement('textarea');
        inputElement.className = 'form-control form-control-sm';
        inputElement.rows = 3;
    } else {
        inputElement = document.createElement('input');
        inputElement.type = 'text';
        inputElement.className = 'form-control form-control-sm';
    }
    
    inputElement.value = currentValue.includes('Click to add') ? '' : currentValue;
    
    // Replace element with input
    element.style.display = 'none';
    element.parentNode.insertBefore(inputElement, element.nextSibling);
    inputElement.focus();
    inputElement.select();
    
    // Save on blur or Enter
    const saveEdit = () => {
        const newValue = inputElement.value.trim();
        
        if (newValue !== currentValue) {
            // Make API call to save changes
            const updateData = {};
            updateData[fieldType] = newValue;
            
            fetch(`/api/artworks/${artworkId}/`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify(updateData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.id) {
                    element.textContent = newValue || `Click to add ${fieldType}`;
                    showToast(`${fieldType.charAt(0).toUpperCase() + fieldType.slice(1)} updated`, 'success');
                } else {
                    showToast(`Failed to update ${fieldType}`, 'error');
                    element.textContent = currentValue;
                }
            })
            .catch(error => {
                console.error(`Error updating ${fieldType}:`, error);
                showToast(`Failed to update ${fieldType}`, 'error');
                element.textContent = currentValue;
            });
        }
        
        inputElement.remove();
        element.style.display = '';
    };
    
    const cancelEdit = () => {
        inputElement.remove();
        element.style.display = '';
    };
    
    inputElement.addEventListener('blur', saveEdit);
    inputElement.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            saveEdit();
        }
        if (e.key === 'Escape') {
            e.preventDefault();
            cancelEdit();
        }
    });
}

// CSRF Token helper
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Bulk action functions with API calls
function bulkPublish() {
    if (selectedArtworks.size === 0) return;
    
    fetch('/api/artworks/bulk_actions/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            artwork_ids: Array.from(selectedArtworks),
            action: 'publish'
        })
    })
    .then(response => response.json())
    .then(data => {
        showToast(`Published ${selectedArtworks.size} artworks`, 'success');
        // Update UI for selected artworks
        selectedArtworks.forEach(id => {
            const item = document.querySelector(`[data-artwork-id="${id}"]`);
            if (item) {
                item.dataset.status = 'published';
                updateStatusBadges(item, 'published');
            }
        });
        calculateStatistics();
        cancelBulkActions();
    })
    .catch(error => {
        console.error('Bulk publish error:', error);
        showToast('Failed to publish artworks', 'error');
    });
}

function bulkDraft() {
    if (selectedArtworks.size === 0) return;
    
    fetch('/api/artworks/bulk_actions/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            artwork_ids: Array.from(selectedArtworks),
            action: 'draft'
        })
    })
    .then(response => response.json())
    .then(data => {
        showToast(`Marked ${selectedArtworks.size} artworks as draft`, 'success');
        // Update UI for selected artworks
        selectedArtworks.forEach(id => {
            const item = document.querySelector(`[data-artwork-id="${id}"]`);
            if (item) {
                item.dataset.status = 'draft';
                updateStatusBadges(item, 'draft');
            }
        });
        calculateStatistics();
        cancelBulkActions();
    })
    .catch(error => {
        console.error('Bulk draft error:', error);
        showToast('Failed to mark artworks as draft', 'error');
    });
}

function bulkToggleCritique() {
    if (selectedArtworks.size === 0) return;
    
    fetch('/api/artworks/bulk_actions/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            artwork_ids: Array.from(selectedArtworks),
            action: 'toggle_critique'
        })
    })
    .then(response => response.json())
    .then(data => {
        showToast(`Toggled critique requests for ${selectedArtworks.size} artworks`, 'success');
        // Update UI for selected artworks
        selectedArtworks.forEach(id => {
            const item = document.querySelector(`[data-artwork-id="${id}"]`);
            if (item) {
                const currentSeeking = item.dataset.seekingCritique === 'true';
                item.dataset.seekingCritique = (!currentSeeking).toString();
                updateCritiqueBadge(item, !currentSeeking);
            }
        });
        calculateStatistics();
        cancelBulkActions();
    })
    .catch(error => {
        console.error('Bulk critique toggle error:', error);
        showToast('Failed to toggle critique requests', 'error');
    });
}

function bulkDelete() {
    if (selectedArtworks.size === 0) return;
    
    if (confirm(`Are you sure you want to delete ${selectedArtworks.size} selected artworks? This action cannot be undone.`)) {
        fetch('/api/artworks/bulk_actions/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                artwork_ids: Array.from(selectedArtworks),
                action: 'delete'
            })
        })
        .then(response => response.json())
        .then(data => {
            showToast(`Deleted ${selectedArtworks.size} artworks`, 'success');
            // Remove deleted artworks from UI
            selectedArtworks.forEach(id => {
                const item = document.querySelector(`[data-artwork-id="${id}"]`);
                if (item) {
                    item.remove();
                }
            });
            calculateStatistics();
            cancelBulkActions();
        })
        .catch(error => {
            console.error('Bulk delete error:', error);
            showToast('Failed to delete artworks', 'error');
        });
    }
}

// Toast notification system
function showToast(message, type = 'info') {
    // Remove existing toasts
    const existingToasts = document.querySelectorAll('.toast-notification');
    existingToasts.forEach(toast => toast.remove());
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast-notification alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'info'} position-fixed`;
    toast.style.cssText = `
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border: none;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
    `;
    
    toast.innerHTML = `
        <div class="d-flex align-items-center">
            <div class="me-2">
                ${type === 'success' ? 
                    '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/></svg>' :
                type === 'error' ? 
                    '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-exclamation-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/></svg>' :
                    '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg>'
                }
            </div>
            <div class="flex-grow-1">${message}</div>
            <button type="button" class="btn-close ms-2" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Animate in
    setTimeout(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateX(0)';
    }, 10);
    
    // Auto remove after 4 seconds
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
    }, 4000);
}
</script>
{% endblock %}